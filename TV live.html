<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sunplus SAT2IP</title>
    <style>
        :root {
            --golden-diamond: #bfa14b;
            --silver: #c0c0c0;
            --copper: #b87333;
            --text-color: #333;
            --background-color: #f0f2f5;
            --control-bg: #f9f9f9;
            --border-color: var(--copper);
            --primary-color: var(--golden-diamond);
            --secondary-color: var(--silver);
            --green-screen: #04ff00;
            --error-red: #ff3333;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0; 
            padding: 10px 15px;
            text-align: center;
            line-height: 1.2;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 2.3rem;
            margin: 0 0 10px 0;
            z-index: 1001;
        }
        
        .video-container {
            position: sticky;
            top: 0;
            width: 100%;
            max-height: 40vh;
            z-index: 1000;
            margin-bottom: 6px;
        }
        
        #videoPlayer {
            width: 100%;
            height: 100%;
            background-color: #000;
            border-radius: 8px;
            box-shadow: 0 0 12px var(--golden-diamond);
        }
        
        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
            align-items: center;
            z-index: 1002;
        }
        
        #toggleMuteBtn {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        #toggleMuteBtn:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        #channelDisplay {
            position: sticky;
            top: calc(40vh + 6px);
            background-color: #000;
            color: var(--green-screen);
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 1.3rem;
            width: 100px;
            margin: 0 auto 12px auto;
            border-radius: 5px;
            padding: 6px 0;
            box-shadow: 0 0 8px var(--green-screen);
            user-select: none;
            z-index: 1001;
        }
        
        .channel-controls {
            position: sticky;
            top: calc(40vh + 50px);
            background: var(--control-bg);
            max-width: 900px;
            margin: 0 auto 10px auto;
            padding: 8px 10px;
            border-radius: 10px;
            box-shadow: 0 0 10px var(--copper);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }
        
        .channel-step-buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: nowrap;
            align-items: center;
        }
        
        .channel-step-buttons.positive,
        .channel-step-buttons.negative {
            justify-content: center;
        }
        
        .channel-step-buttons button,
        .channel-step-buttons.volume-button {
            flex: 1 1 16%;
            padding: 8px 0;
            font-size: 1.1rem;
            background-color: var(--secondary-color);
            border: 2px solid var(--copper);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            min-width: 48px;
        }
        
        .channel-step-buttons button:hover,
        .channel-step-buttons.volume-button:hover {
            background-color: var(--golden-diamond);
            color: white;
        }
        
        .volume-button {
            flex: 1 1 12%;
            font-size: 1.2rem;
            padding: 8px 6px;
            max-width: 48px;
        }
        
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 15px center;
            max-width: 400px;
            width: 100%;
            padding: 6px 12px;
            border-radius: 6px;
            border: 2px solid var(--copper);
            background-color: var(--secondary-color);
            color: var(--text-color);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 6px auto 0 auto;
            display: block;
            font-size: 1rem;
            height: 32px;
            overflow: hidden;
            line-height: 1.2;
        }
        
        select:hover, select:focus {
            background-color: var(--golden-diamond);
            color: white;
            outline: none;
            border-color: var(--golden-diamond);
        }
        
        input[type="text"] {
            width: 80px;
            max-width: 100%;
            padding: 5px 8px;
            border-radius: 6px;
            border: 2px solid var(--copper);
            font-size: 0.85rem;
            text-align: center;
            background-color: var(--secondary-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus {
            background-color: var(--golden-diamond);
            color: white;
            outline: none;
            border-color: var(--golden-diamond);
        }
        
        #portInput {
            width: 60px;
            max-width: 100%;
        }
        
        body, button {
            user-select: none;
        }
        
        button {
            border: none;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 15px 120px 15px;
            background-color: var(--control-bg);
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
            z-index: 1;
        }
        
        .controls-server {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 900px;
            width: 100%;
            background: var(--control-bg);
            padding: 6px 10px;
            box-shadow: 0 -3px 10px var(--copper);
            border-top: 2px solid var(--copper);
            z-index: 1005;
            font-size: 0.75rem;
            color: var(--text-color);
            display: none;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
        }
        
        .server-inputs {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 100px;
        }
        
        label {
            font-weight: bold;
            white-space: nowrap;
            margin-bottom: 2px;
            text-align: right;
        }
        
        #updateServerBtn {
            height: 36px;
            padding: 0 12px;
            border-radius: 6px;
            border: 2px solid var(--copper);
            font-weight: bold;
            font-size: 0.85rem;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            user-select: none;
            align-self: flex-end;
            transition: all 0.3s ease;
        }
        
        #updateServerBtn:hover {
            background-color: var(--copper);
        }
        
        #toggleServerSettings {
            cursor: pointer;
            color: var(--golden-diamond);
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 10px;
            user-select: none;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        #toggleServerSettings:hover {
            background-color: rgba(191, 161, 75, 0.1);
        }
        
        #errorMessage {
            color: var(--error-red);
            font-weight: bold;
            margin: 5px 0;
            min-height: 20px;
        }
        
        #clearHistoryBtn {
            background-color: var(--error-red);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #clearHistoryBtn:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sunplus SAT2IP</h1>

        <div class="video-container">
            <video id="videoPlayer" controls autoplay muted playsinline></video>
            <div class="video-controls">
                <button id="toggleMuteBtn" aria-label="ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª">ğŸ”‡</button>
            </div>
        </div>

        <div id="channelDisplay" aria-live="polite" aria-atomic="true">Ù…Ø¨Ø§Ø´Ø±</div>

        <div id="errorMessage" aria-live="assertive"></div>

        <select id="channelSelect" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ù†Ø§Ø©"></select>

        <div class="channel-controls" aria-label="Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù‚Ù†ÙˆØ§Øª">
            <div class="channel-step-buttons positive" aria-label="Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚Ù†Ø§Ø©">
                <button class="changeChannelBtn" data-step="1">+1</button>
                <button class="changeChannelBtn" data-step="10">+10</button>
                <button class="changeChannelBtn" data-step="20">+20</button>
                <button class="changeChannelBtn" data-step="50">+50</button>
                <button class="changeChannelBtn" data-step="100">+100</button>
                <button class="volume-button" id="volumeUpBtn" aria-label="Ø±ÙØ¹ Ø§Ù„ØµÙˆØª">ğŸ”Š</button>
            </div>
            <div class="channel-step-buttons negative" aria-label="Ù†Ù‚ØµØ§Ù† Ø§Ù„Ù‚Ù†Ø§Ø©">
                <button class="changeChannelBtn" data-step="-1">-1</button>
                <button class="changeChannelBtn" data-step="-10">-10</button>
                <button class="changeChannelBtn" data-step="-20">-20</button>
                <button class="changeChannelBtn" data-step="-50">-50</button>
                <button class="changeChannelBtn" data-step="-100">-100</button>
                <button class="volume-button" id="volumeDownBtn" aria-label="Ø®ÙØ¶ Ø§Ù„ØµÙˆØª">ğŸ”‰</button>
            </div>
        </div>

        <select id="lastChannels" aria-label="Ø¢Ø®Ø± Ù¥ Ù‚Ù†ÙˆØ§Øª ØªÙ… ØªØ´ØºÙŠÙ„Ù‡Ø§" title="Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù‚Ù†Ø§Ø© Ù„ØªØ´ØºÙŠÙ„Ù‡Ø§"></select>
        <button id="clearHistoryBtn">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>

        <div id="toggleServerSettings" tabindex="0" role="button" aria-pressed="false" aria-label="Ø¹Ø±Ø¶ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±">
            âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±
        </div>
    </div>

    <div class="controls-server" aria-label="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±">
        <div class="server-inputs">
            <label for="ipInput">Ø¹Ù†ÙˆØ§Ù† IP:</label>
            <input type="text" id="ipInput" value="192.168.1.88" placeholder="Ø§Ø¯Ø®Ù„ IP Ù‡Ù†Ø§" />
        </div>
        <div class="server-inputs">
            <label for="portInput">Ø§Ù„Ø¨ÙˆØ±Øª:</label>
            <input type="text" id="portInput" maxlength="6" value="9891" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙˆØ±Øª Ù‡Ù†Ø§" />
        </div>
        <button id="updateServerBtn" aria-label="ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ±ÙØ±</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        let defaultIP = "192.168.1.88";
        let defaultPort = "9891";
        let channelCount = 2000;
        let lastChannels = [];

        // Ø¹Ù†Ø§ØµØ± DOM
        const video = document.getElementById("videoPlayer");
        const channelSelect = document.getElementById("channelSelect");
        const ipInput = document.getElementById("ipInput");
        const portInput = document.getElementById("portInput");
        const updateServerBtn = document.getElementById("updateServerBtn");
        const volumeUpBtn = document.getElementById("volumeUpBtn");
        const volumeDownBtn = document.getElementById("volumeDownBtn");
        const lastChannelsSelect = document.getElementById("lastChannels");
        const toggleServerSettingsBtn = document.getElementById("toggleServerSettings");
        const controlsServerDiv = document.querySelector(".controls-server");
        const channelDisplay = document.getElementById("channelDisplay");
        const errorMessage = document.getElementById("errorMessage");
        const clearHistoryBtn = document.getElementById("clearHistoryBtn");
        const toggleMuteBtn = document.getElementById("toggleMuteBtn");

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadSettings() {
            if (localStorage.getItem('sat2ipSettings')) {
                const settings = JSON.parse(localStorage.getItem('sat2ipSettings'));
                defaultIP = settings.ip;
                defaultPort = settings.port;
                ipInput.value = settings.ip;
                portInput.value = settings.port;
            }
            
            if (localStorage.getItem('lastChannels')) {
                lastChannels = JSON.parse(localStorage.getItem('lastChannels'));
                updateLastChannelsUI();
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© IP
        function isValidIP(ip) {
            return /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ip);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙˆØ±Øª
        function isValidPort(port) {
            return /^[0-9]{1,5}$/.test(port) && parseInt(port) <= 65535;
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
        function updateLastChannelsUI() {
            lastChannelsSelect.innerHTML = "";
            lastChannels.forEach(ch => {
                const option = document.createElement("option");
                option.value = (ch === "Ù…Ø¨Ø§Ø´Ø±") ? "" : ch;
                option.textContent = ch;
                lastChannelsSelect.appendChild(option);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
        function updateLastChannels(channelNumber) {
            if(channelNumber === "") channelNumber = "Ù…Ø¨Ø§Ø´Ø±";
            else channelNumber = String(channelNumber);
            
            lastChannels = lastChannels.filter(ch => ch !== channelNumber);
            lastChannels.unshift(channelNumber);
            if(lastChannels.length > 5) lastChannels.pop();
            
            updateLastChannelsUI();
            localStorage.setItem('lastChannels', JSON.stringify(lastChannels));
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«
        function generateStreamUrl(channelNumber) {
            if(channelNumber === "") 
                return `http://${defaultIP}:${defaultPort}/live`;
            return `http://${defaultIP}:${defaultPort}/live/${channelNumber}`;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«
        function loadStream(channelNumber) {
            if(channelNumber === null || channelNumber === undefined) return;

            const streamUrl = generateStreamUrl(channelNumber);
            errorMessage.textContent = "";
            channelDisplay.textContent = channelNumber === "" ? "Ù…Ø¨Ø§Ø´Ø±" : channelNumber;

            if(window.hls) {
                window.hls.destroy();
                window.hls = null;
            }

            if(Hls.isSupported()) {
                try {
                    window.hls = new Hls();
                    window.hls.loadSource(streamUrl);
                    window.hls.attachMedia(video);
                    
                    window.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        video.muted = true;
                        video.play().catch(e => {
                            errorMessage.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ";
                            console.error("Play error:", e);
                        });
                    });
                    
                    window.hls.on(Hls.Events.ERROR, (event, data) => {
                        if(data.fatal) {
                            errorMessage.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©";
                            console.error("HLS Error:", data);
                        }
                    });
                } catch(e) {
                    errorMessage.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´ØºÙ„";
                    console.error("HLS Init Error:", e);
                }
            } else if(video.canPlayType("application/vnd.apple.mpegurl")) {
                video.src = streamUrl;
                video.muted = true;
                video.play().catch(e => {
                    errorMessage.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ";
                    console.error("Play error:", e);
                });
            } else {
                errorMessage.textContent = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ";
            }
            
            channelSelect.value = channelNumber;
            updateLastChannels(channelNumber);
        }

        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª
        function populateChannels(start, end) {
            channelSelect.innerHTML = "";
            
            const liveOption = document.createElement("option");
            liveOption.value = "";
            liveOption.textContent = "Ù…Ø¨Ø§Ø´Ø±";
            channelSelect.appendChild(liveOption);

            for(let i = start; i <= end; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = `Ø§Ù„Ù‚Ù†Ø§Ø© ${i}`;
                channelSelect.appendChild(option);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ÙƒØªÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª
        function updateMuteButton() {
            if(video.muted) {
                toggleMuteBtn.textContent = "ğŸ”‡";
                toggleMuteBtn.setAttribute("aria-label", "Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª");
            } else {
                toggleMuteBtn.textContent = "ğŸ”Š";
                toggleMuteBtn.setAttribute("aria-label", "ÙƒØªÙ… Ø§Ù„ØµÙˆØª");
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        function init() {
            loadSettings();
            populateChannels(1, channelCount);
            loadStream("");
            updateMuteButton();
        }

        // Ø£Ø­Ø¯Ø§Ø« DOM
        channelSelect.addEventListener("change", () => {
            loadStream(channelSelect.value);
        });

        lastChannelsSelect.addEventListener("change", () => {
            loadStream(lastChannelsSelect.value);
        });

        toggleServerSettingsBtn.addEventListener("click", () => {
            controlsServerDiv.style.display = controlsServerDiv.style.display === "flex" ? "none" : "flex";
            toggleServerSettingsBtn.setAttribute("aria-pressed", 
                controlsServerDiv.style.display === "flex" ? "true" : "false");
        });

        toggleServerSettingsBtn.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                toggleServerSettingsBtn.click();
            }
        });

        updateServerBtn.addEventListener("click", () => {
            const ipVal = ipInput.value.trim();
            const portVal = portInput.value.trim();

            if(!isValidIP(ipVal)) {
                errorMessage.textContent = "Ø¹Ù†ÙˆØ§Ù† IP ØºÙŠØ± ØµØ­ÙŠØ­";
                return;
            }

            if(!isValidPort(portVal)) {
                errorMessage.textContent = "Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆØ±Øª ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 65535)";
                return;
            }

            defaultIP = ipVal;
            defaultPort = portVal;
            
            localStorage.setItem('sat2ipSettings', JSON.stringify({ 
                ip: defaultIP, 
                port: defaultPort 
            }));

            loadStream(channelSelect.value);
        });

        document.querySelectorAll(".changeChannelBtn").forEach(btn => {
            btn.addEventListener("click", () => {
                let step = Number(btn.getAttribute("data-step"));
                let current = channelSelect.value === "" ? 0 : Number(channelSelect.value);

                let newChannel = current + step;
                if(newChannel < 1) newChannel = 1;
                if(newChannel > channelCount) newChannel = channelCount;

                loadStream(newChannel);
            });
        });

        volumeUpBtn.addEventListener("click", () => {
            video.volume = Math.min(1, video.volume + 0.1);
        });

        volumeDownBtn.addEventListener("click", () => {
            video.volume = Math.max(0, video.volume - 0.1);
        });

        clearHistoryBtn.addEventListener("click", () => {
            lastChannels = [];
            localStorage.removeItem('lastChannels');
            updateLastChannelsUI();
        });

        // ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªÙ…
        toggleMuteBtn.addEventListener("click", () => {
            video.muted = !video.muted;
            updateMuteButton();
        });

        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ÙƒØªÙ… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª
        video.addEventListener("volumechange", updateMuteButton);

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        init();
    </script>
</body>
</html>